---
phase: 02-auzoom-core-verification
plan: 01
type: execute
domain: auzoom-structured-code
---

<objective>
Test progressive disclosure (skeleton → summary → full) to verify token reduction claims against real AuZoom implementation.

Purpose: Validate Assumption 1 core mechanism - hierarchical file reading reduces context compared to full reads.
Output: Test results showing token counts at each disclosure level with evidence for token reduction claims.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/WISHLIST-COMPLIANCE.md

# Phase 1 context
@.planning/phases/01-audit-foundation-traceability/01-01-SUMMARY.md
@.planning/phases/01-audit-foundation-traceability/01-02-SUMMARY.md

# Audit infrastructure
@audit/audit_harness.py
@audit/templates/test_template.py

# AuZoom implementation
@auzoom/src/auzoom/tools.py
@auzoom/src/auzoom/models.py

**Established patterns from Phase 1:**
- Evidence-based audit: Every claim mapped to file:line
- AuditTest base class for test structure
- JSON Lines evidence collection

**Key decisions constraining this phase:**
- Token reduction target ≥50% missed (actual 23%) - must verify root cause
- Small file overhead identified (tasks 2.1, 3.1, 4.1) - test across file sizes
- Baseline at commit 024c988 for comparison
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create progressive disclosure token measurement test</name>
  <files>audit/tests/test_progressive_disclosure.py</files>
  <action>Create test using AuditTest base class to measure token counts at skeleton/summary/full levels. Test on multiple file sizes: small (<200 lines), medium (200-400 lines), large (>400 lines). Use auzoom_read tool with level parameter. Use tiktoken (cl100k_base encoding) to count tokens at each level. Calculate reduction percentages. Record evidence: file path, size, skeleton tokens, summary tokens, full tokens, reduction %. Do NOT use mock data - test against real files in auzoom/ and orchestrator/ directories. Avoid using placeholder assertions - calculate actual percentages and compare to ≥50% target.</action>
  <verify>pytest audit/tests/test_progressive_disclosure.py -v passes, evidence JSON Lines written to audit/evidence/</verify>
  <done>Test executable, measures tokens at 3 levels for 6+ files (2 small, 2 medium, 2 large), evidence collected with file:line citations</done>
</task>

<task type="auto">
  <name>Task 2: Execute progressive disclosure test and analyze results</name>
  <files>audit/evidence/progressive_disclosure_*.jsonl, audit/reports/02-01-progressive-disclosure.md</files>
  <action>Run test with pytest -v. Capture evidence to JSON Lines file. Analyze results: calculate average token reduction by file size category (small/medium/large). Compare to ≥50% target. Identify if small files show overhead (skeleton+summary > full). Create markdown report with: test methodology, sample files tested, token counts table, reduction percentages by category, comparison to target, root cause analysis if target missed. Include file:line references for all evidence. If small files show increases, document threshold where progressive disclosure becomes beneficial.</action>
  <verify>Report exists at audit/reports/02-01-progressive-disclosure.md, evidence file has entries for all test cases, report includes specific token counts and percentages</verify>
  <done>Evidence collected, report written with quantitative findings (average reductions, threshold analysis, target comparison), root cause identified if applicable</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Test runs successfully with pytest
- [ ] Token counts measured at all 3 levels (skeleton, summary, full)
- [ ] Results cover small/medium/large file categories
- [ ] Evidence JSON Lines file contains all test case data
- [ ] Report documents findings with file:line citations
- [ ] Comparison to ≥50% target included in report
</verification>

<success_criteria>

- Test implemented using AuditTest base class
- Progressive disclosure token reduction measured on real files
- Evidence collected for 6+ files across 3 size categories
- Report documents whether ≥50% target met and why/why not
- No errors or warnings introduced
  </success_criteria>

<output>
After completion, create `.planning/phases/02-auzoom-core-verification/02-01-SUMMARY.md`:

# Phase 2 Plan 01: Progressive Disclosure Token Reduction Summary

**[Substantive one-liner - findings on token reduction by file size]**

## Accomplishments

- Created progressive disclosure test measuring tokens at skeleton/summary/full levels
- Tested X files across 3 size categories (small/medium/large)
- Calculated token reduction percentages and compared to ≥50% target
- Identified root cause if target missed

## Files Created/Modified

- `audit/tests/test_progressive_disclosure.py` - Token measurement test
- `audit/evidence/progressive_disclosure_*.jsonl` - Test evidence
- `audit/reports/02-01-progressive-disclosure.md` - Findings report

## Decisions Made

[Analysis of token reduction findings - which file sizes benefit, threshold recommendations]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 02-02-PLAN.md (dependency tracking accuracy verification)
</output>
